# Admin Account Setup Guide

This project now uses a real authentication flow driven by the `/api/auth` route.
Administrator accounts are persisted in `data/admin-users.json` (or the
`admin_users` table when you migrate to PostgreSQL with Prisma). Each account
stores a bcrypt-hashed password and receives a signed JWT when logging in.

## 1. Prerequisites
- Provide a strong `JWT_SECRET` in your environment (`.env.local`,
  `.env.production`, or hosting provider secrets). The server refuses to start
  without it.
- Populate the contact form SMTP variables so password reset or alert emails can
  be wired up later (`CONTACT_RECIPIENT_EMAIL`, `SMTP_*` keys).
- Commit the `data/` directory only for local development—never to production.

## 2. Creating the First Admin
Run the bootstrap script to create a clean admin user:

```bash
npm run setup-admin
```

The script:
1. Ensures the `data/` directory exists.
2. Replaces `data/admin-users.json` with a single administrator account.
3. Generates a bcrypt hash for the default password (`admin2024`).

**Important:** The script overwrites the existing admin list. Rerun it only when
you intentionally want to reset credentials.

### Customising the Seeded Admin
Edit `setup-admin.mjs` before running the script if you need different initial
values (name, email, phone, etc.). After the first login you can change the
password by calling the `/api/admin/users` endpoints from an authenticated
client.

## 3. Logging In
1. Visit `/login`.
2. Enter the email/password generated by the setup script.
3. On success the client stores `auth_token` (JWT) in `localStorage`.
4. Authenticated requests include `Authorization: Bearer <token>`, which the
   server verifies in `lib/auth-middleware.ts` before allowing access to admin
   routes.

The same flow applies to end-user registrations (`action: "register"` in
`/api/auth`). Registered users default to the `user` role until an admin promotes
them.

## 4. Managing Admin Accounts
- `GET /api/admin/users` – Lists accounts (requires admin token).
- `POST /api/admin/users` – Creates a new account with a hashed password.
- `PUT /api/admin/users/:id` – Updates status, role, or profile details.
- `DELETE /api/admin/users/:id` – Removes the account.

All endpoints are now protected by `requireAdmin(...)` middleware. Calls without
an admin JWT receive `401` or `403` responses.

## 5. Production Checklist
- Replace the default credentials immediately after deployment.
- Rotate `JWT_SECRET` if you suspect leakage and reissue tokens.
- Move storage from JSON to PostgreSQL via Prisma when you scale beyond a single
  server. Use `scripts/01-create-tables.sql` and `prisma migrate` to set up the
  schema, then update `DATABASE_URL`.
- Consider integrating an SMTP-backed password reset flow and enforcing strong
  password policies.

With these steps in place your admin area ships with hashed credentials, JWT
sessions, and locked-down API routes suitable for production use.
